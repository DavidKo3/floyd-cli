# CircleCI Configuration file

machine:
  python:
      version: 2.7.11

general:
  artifacts:
     - "dist"

dependencies:
  override:
    - pip install tox tox-pyenv flake8
    - pyenv local 2.7.11 3.5.2 3.6.2 # Should correspond to pre-installed Python versions on CircleCI

test:
  override:
     - flake8 floyd
     - tox

deployment:
  pypi:
    branch: /release.*/
    owner: floydhub
    commands:
      - echo "[distutils]" > ~/.pypirc
      - echo "index-servers =" >> ~/.pypirc
      - echo "    pypi" >> ~/.pypirc
      - echo >> ~/.pypirc
      - echo "[pypi]" >> ~/.pypirc
      - echo "username:$PYPI_USERNAME" >> ~/.pypirc
      - echo "password:$PYPI_PASSWORD" >> ~/.pypirc
      - echo >> ~/.pypirc
      - python setup.py register -r pypi
      - python setup.py sdist upload -r pypi
  anaconda:
    #branch: /release.*/
    branch: /.*/
    commands:
      - wget https://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh -O miniconda.sh
      - bash miniconda.sh -b -p $HOME/miniconda3
      - $HOME/miniconda3/bin/conda config --set always_yes yes
      - $HOME/miniconda3/bin/conda install conda-build
      - $HOME/miniconda3/bin/conda build conda
